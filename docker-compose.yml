version: '3.8'

services:
  provisioner:
    build: .
    image: oci-arm-provisioner
    container_name: oci-provisioner
    restart: unless-stopped
    volumes:
      # Mount config and logs
      - ./config.yaml:/app/config.yaml
      - ./logs:/app/logs
      # Mount OCI Keys (Read Only) - Ensure keys are in ~/.oci locally!
      - ${HOME}/.oci:/root/.oci:ro
    environment:
      # We don't need OCI_KEY_DIR env var if config uses absolute paths inside container?
      # Our Go code expands ~/.oci to user home.
      # In Docker, user is root (default). Home is /root.
      # So ~/.oci resolves to /root/.oci
      # This mount works perfectly.
      # - OCI_CLI_CONFIG_FILE=/root/.oci/config

      # Optional: Override Notifications via Env
      # - OCI_NOTIFY_WEBHOOK=https://discord.com/api/webhooks/...
      # - OCI_NOTIFY_TELEGRAM_TOKEN=123:ABC...
      # - OCI_NOTIFY_TELEGRAM_CHAT=987654
      # - OCI_NOTIFY_NTFY_TOPIC=my-secret-topic
      # - OCI_NOTIFY_GOTIFY_URL=https://gotify.example.com
      # - OCI_NOTIFY_GOTIFY_TOKEN=A1b2...

    # Best Practice: Limit log size to prevent filling disk
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
